import string
from sage.all import *
from secret import flag

def bytes_to_long(b):
    return int.from_bytes(b, 'big')


ext_len = 9 * 23 - len(flag)
if ext_len > 0:
    printable_chars = string.printable
    flag += ''.join(printable_chars[randint(0, len(printable_chars)-1)] for _ in range(ext_len))
else:
    flag = flag[:207]

data = []
for i in range(9):
    block = flag[23*i:23*(i+1)]
    block_bytes = block.encode('utf-8')
    block_int = bytes_to_long(block_bytes)
    data.append(block_int)

p = random_prime(2**512, lbound=2**511)
q = random_prime(2**512, lbound=2**511)
n = p * q

data_matrix = [data[i:i+3] for i in range(0, len(data), 3)]
M = Matrix(Zmod(n), data_matrix)

e = 65537

C = M ** e

print("p的高位 (p >> 100):", p >> 100)
print("n:", n)
print("C:", C)

"""
输出结果：
p = 5425868832022021239095252906502022450852257317689216698099280002230002133473711383403976323100896253201677408037782220861602
n = 88226638805385942953884272941221647121747182341986832939583859982214382172874908481171757534708217242783559827543409272566262226113380346551716147121846982225255823791447864111237661151679031264100795533045810423460673081228875036630393571542438211404933211187648078265348999545733567123784552322442630135397
C = [
        [13089683396882822610237950917692086942353667912303562838630965495187331323279561534499322817476232776288395929031984619186735879140101971217025442480060061947015387230263726793365028272492458182484972565398415071477862084887064978506745069981424275819128925162465387584154332994831115780030284388355176360925,
         15126607517443755027468562020112356159456565433831897738989900811579355604902627427222949452657661225169381749601997533361457503783378041590668407674383682929054775861093767243496544481628125689334853207471337458187762008407778086555476614428492441407926515533190955957083908780268733466248760529939878719526,
         1777902544941838776608655261789385017624542987620405927006108606229405714174351136077319587151479813752665455810041634755218092754853357974083075322834442343018524811666766505233813810576644496465648531102238055256600746092027955055154455724623254852215058930599297247809748270410638745410561972874382099493],
         
        [11225652786956624684449115520782782802637382155309913077201893673727539858014927991863339381443067341832848758862892126457452284555939930333512986665276178316268590167798142050111448907330845570695920054186353056447878340034403703183135611568885599206546910548965762846872400861990753188879796295665384804876,
         59719669493575846026982547877397725122486591233292550636704540204887405160945963150045255834247016732194154847520195309163784000577682893913298364603866782333062881491722946301769493486625517921145510648815533491164186140316814683721749592308665956015362389229737951744258284191717786238331843420083035546140,
         55310996974664872814875825976382758325058934250406874804398221781540414562184405453348656612463147161304330214402296838592956750712812950103951239158719580233236390471989625240015732204388383486696358610333925945970837044693558667594284828988549379270403535169798456744071676177314249170143299645457883937198],
         
        [75553808075086235072043335114109847394911427301175978185163439946154003321591999521314751238944797963495827991664880475719828859429468519733172348332825224584004990092381837678923056571428589543472396830581795566427063719031283164787247457106436973873070297216176165726226046747133556780685958122074659010709, 
         45934174628853038590335368252913369299256140361778373533778159653273603194961868440420328237028857238698235150968164997843251093057053798084814111819660759546432760141174079755547009548005707844922641070733197901221084412110587137964089017440746169667565237195404375202886717655730868713060180553504333831684,
         22264023855535934344596315841364764574276411124674519717109813953940374689712971643757532663361478823804053961807198662828467395093514256986653469854313305522349446368606439385233616198623045329039741711853335424139907858715396838633268322651273842098516054906440391756280407547604050127169802156054955744965]
    ]
"""

