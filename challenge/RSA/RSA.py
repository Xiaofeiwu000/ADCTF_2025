from secret import flag
from Crypto.Util.number import *
import gmpy2


# 生成两个大素数
p = getPrime(512)
q = getPrime(512)

# 计算n和φ(n)
n = p * q
phi = (p - 1) * (q - 1)

# 选择公共指数e
e = 65537

# 计算私钥d
d = gmpy2.invert(e, phi)

# 计算dp = d mod (p-1)
dp = d % (p - 1)

m = bytes_to_long(flag.encode())

# 确保m < n
if m >= n:
    raise ValueError("明文太大，重新生成参数")

# 加密得到c
c = pow(m, e, n)

print("=== CTF题目 ===")
print("已知以下RSA参数：")
print(f"n = {n}")
print(f"dp = {dp}")
print(f"c = {c}")

"""
n = 98523589166698215884772678597126381330729042409867906419776228376328394083113113810566361681776383135721618320266085382467318657506884467970213696370301053102178834366258554086282183236507513622996917266419984601116179992149604378946213411633778008170053460579973392211434938839020605646327849068116301554053
dp = 5138636274856700080941828013807156958082237286853007924695738133342859363355437998008259170260315338728640155874737284930133190696925369174593997368399761
c = 81387127961421902230857210411279023161773956760695301546933898924006410439044243629343875994387728788391446830661374802652363868007527718797900701113897594566288568833319705717842048295047236231759241072305294457689433087267810684045886576363621162635358100858319636959737626031693142150135828215563162557116
"""


